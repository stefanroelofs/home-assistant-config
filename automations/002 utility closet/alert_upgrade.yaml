#################################################################
## Notify on phone when new Home Assistant version is available
#################################################################
- alias         : system_alert_upgrade
  id            : f91e8ddf-fd5c-47b6-8443-880303081333
  trigger:
    platform    : state
    entity_id   : binary_sensor.updater   # Also triggers on attribute changes
  condition:
    - condition : state
      entity_id : binary_sensor.updater
      state     : "on"
  action:
    - service   : notify.stefan
      data:
        title   : Upgrade time!
        message : >-
          "Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version') }} is available."
        data:
          tag         : ha_upgrade
          icon_url    : !secret url_update_icon
          clickAction : "{{ state_attr('binary_sensor.updater', 'release_notes') }}"
          group       : "ha_notification_group"
    - service   : persistent_notification.create
      data:
        title   : Upgrade time!
        message : >-
          "Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version') }} is available."
        notification_id: ha_upgrade
