- alias         : general_picnic_order_window_closing
  id            : df255aa4-3063-47e7-bb34-55361c6c4908
  mode          : single
  description   : Send a notification when there is 1 hour left to add groceries to the current order

  trigger:
    - platform: template
      value_template: >-
        {% if states('sensor.picnic_last_order_slot_start') != "unavailable" %}
          {{ 3600 > (as_timestamp(states('sensor.picnic_last_order_slot_start')) - as_timestamp(states('sensor.date') + " " + states('sensor.time'))) > 0}}
        {% endif %}

  action:
    - service   : tts.cloud_say
      entity_id : media_player.smart_speaker
      data:
        message : >
          Bestel nog snel je laatste Picnic boodschappen! Over een uur kan het niet meer.
        language: 'nl-NL'

    - service   : notify.all
      data:
        title   : Picnic komt eraan!
        message : >
          Bestel nog snel je laatste Picnic boodschappen! Na {{ as_timestamp(states("sensor.picnic_selected_slot_end")) | timestamp_custom("%H:%M") }} kan het niet meer.
        data:
          icon_url    : "https://picnic.app/nl/wp-content/uploads/sites/18/2020/11/logo.png"
          clickAction : "app://com.picnic.android"
          timeout     : 3600 # How many seconds the notification should be received by the device
